---
stage: adr
feature: architecture-decision-records
id: 20260131-architecture-decisions
title: "Key technical decisions ADRs"
date: 2026-01-31
author: Claude Code
---

# Prompt History Record: Architecture Decision Records Creation

## Prompt

User requested: `/sp.adr` - Create ADRs for key technical decisions:
- Why Bitnami charts for K8s deployments
- Why Dapr for service mesh
- Why Kafka for event-driven architecture
- Why OpenAI for AI capabilities
- Why Next.js for frontend

## Response

Successfully created **5 Architecture Decision Records (ADRs)** documenting key technical decisions for the LearnFlow platform.

### ADRs Created

| ADR ID | Title | Decision Cluster |
|--------|-------|------------------|
| **ADR-001** | Kubernetes Deployment Strategy Using Bitnami Helm Charts | K8s infrastructure (Kafka, PostgreSQL, apps) |
| **ADR-002** | Dapr for Service Mesh and Event-Driven Architecture | Microservices communication mesh |
| **ADR-003** | Apache Kafka for Event-Driven Microservices Architecture | Asynchronous messaging backbone |
| **ADR-004** | OpenAI for AI-Powered Tutoring and Code Analysis | AI capabilities across 4 agents |
| **ADR-005** | Next.js for Frontend Application Framework | Frontend framework stack |

### ADR-001: Kubernetes Deployment Strategy Using Bitnami Helm Charts

**Decision**: Use Bitnami Helm Charts as the standard deployment method for all Kubernetes infrastructure.

**Components**:
- Kafka: Bitnami Kafka Helm chart
- PostgreSQL: Bitnami PostgreSQL Helm chart
- Application Services: K8s manifests (generated by skills)
- Helm 3.x required

**Key Consequences**:
- ✅ Rapid deployment (<5 minutes)
- ✅ Production-ready (security, HA, resource limits)
- ✅ Upgradability (zero-downtime updates)
- ❌ Abstraction layer complexity
- ❌ Chart update risks

**Alternatives Rejected**:
- Custom K8s manifests (10x more YAML, no upgrade/rollback)
- Kubernetes operators (operational complexity, overkill)
- Managed cloud services (vendor lock-in, cost)

### ADR-002: Dapr for Service Mesh and Event-Driven Architecture

**Decision**: Use Dapr 1.12+ as the service mesh for all 9 FastAPI microservices.

**Components**:
- Pub/Sub: Dapr Kafka component
- State: Dapr PostgreSQL state store
- Service Invocation: Dapr HTTP/gRPC
- Sidecar pattern (app + dapr sidecar per service)

**Key Consequences**:
- ✅ Kafka abstraction (no aiokafka boilerplate)
- ✅ Built-in service discovery and resilience
- ✅ Language agnostic patterns
- ❌ Sidecar overhead (+50-100MB per service)
- ❌ Operational complexity (two-container debugging)

**Alternatives Rejected**:
- Direct Kafka integration (200+ lines boilerplate per service)
- Istio/Linkerd (overkill for 9 services, steeper learning curve)
- Custom framework (3-6 months development cost)

### ADR-003: Apache Kafka for Event-Driven Microservices Architecture

**Decision**: Use Apache Kafka 3.x for all asynchronous inter-service communication.

**Components**:
- 8 predefined topics (learning.requests, concepts.requests, code.submissions, debug.requests, exercise.generated, learning.responses, struggle.detected, progress.events)
- Topic patterns: learning.*, code.*, exercise.*, struggle.*
- Consumer groups for scalability
- JSON with CloudEvents envelope

**Key Consequences**:
- ✅ Service decoupling
- ✅ Scalability (100K+ msgs/sec)
- ✅ Message replayability
- ❌ Operational complexity (Zookeeper/KRaft)
- ❌ Resource requirements (4 CPU / 8GB RAM)

**Alternatives Rejected**:
- RabbitMQ (lower throughput, no replay)
- Redis Streams (in-memory, less durable)
- Cloud services (vendor lock-in)
- NATS (smaller ecosystem)

### ADR-004: OpenAI for AI-Powered Tutoring and Code Analysis

**Decision**: Use OpenAI API (GPT-4 Turbo) for all AI agent capabilities.

**Components**:
- Model: GPT-4 Turbo (gpt-4-turbo-preview)
- Fallback: GPT-3.5 Turbo for cost savings
- 4 agent services: Concepts, Code Review, Debug, Exercise
- Circuit breaker pattern with exponential backoff

**Key Consequences**:
- ✅ State-of-the-art quality
- ✅ <3s response time (meets performance target)
- ✅ No infrastructure management
- ❌ Cost ($50-100/month for 100 students)
- ❌ Vendor lock-in
- ❌ Privacy concerns (code sent to OpenAI)

**Alternatives Rejected**:
- Anthropic Claude (slower, more expensive)
- Local LLM (higher infra cost, lower quality)
- Azure OpenAI (vendor lock-in)
- Mixed strategy (complexity)

### ADR-005: Next.js for Frontend Application Framework

**Decision**: Use Next.js 16 with App Router for LearnFlow frontend.

**Components**:
- Next.js 16.1.6 (App Router)
- TypeScript 5+
- React 19 Server Components
- Tailwind CSS 4
- Zustand + TanStack Query
- Monaco Editor integration
- Native WebSocket API

**Key Consequences**:
- ✅ Performance (SSR for <3s page load)
- ✅ Excellent DX (TypeScript, fast refresh)
- ✅ Largest ecosystem
- ❌ Vendor lock-in (Next.js opinions)
- ❌ Server Components learning curve

**Alternatives Rejected**:
- Remix (smaller ecosystem, no SSR)
- Vue + Nuxt (smaller ecosystem, team expertise gap)
- SvelteKit (less mature, Monaco integration issues)
- Vite + React (no SSR, more boilerplate)

### Significance Validation

All 5 ADRs passed the significance test (3/3 criteria):

✅ **Impact**: Long-term architectural consequences
✅ **Alternatives**: Multiple viable options with tradeoffs
✅ **Scope**: Cross-cutting concerns

### Files Created

1. `history/adr/001-kubernetes-bitnami-helm-charts.md`
2. `history/adr/002-dapr-service-mesh.md`
3. `history/adr/003-kafka-event-driven-messaging.md`
4. `history/adr/004-openai-ai-capabilities.md`
5. `history/adr/005-nextjs-frontend-framework.md`
6. `history/adr/README.md` (summary and index)

### Constitution Alignment

| ADR | Principles | Status |
|-----|------------|--------|
| ADR-001 | VII. Kubernetes-Native | ✅ PASS |
| ADR-002 | V. Microservices + Event-Driven | ✅ PASS |
| ADR-003 | V. Microservices + Event-Driven | ✅ PASS |
| ADR-004 | X. Simplicity and YAGNI | ✅ PASS |
| ADR-005 | I. Skills-First | ✅ PASS |

### Next Steps

- Review ADRs with team/stakeholders
- Validate assumptions (OpenAI costs, Kafka performance)
- Proceed with implementation (all decisions accepted)
- Review quarterly or when major tech changes occur

### Status

✅ **PASS** - All ADRs created, validated, and documented
